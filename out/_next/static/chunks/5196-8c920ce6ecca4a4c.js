"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5196],{21934:(e,t,a)=>{a.d(t,{U:()=>s});var r=a(74228);let s={getAllEmployees:async()=>(await r.A.get("/employee/")).data,getEmployeeByWallet:async e=>(await r.A.get("/employee/".concat(e))).data,addEmployee:async e=>(await r.A.post("/employee/add",e)).data,getEmployeePayroll:async e=>(await r.A.get("/employee/payroll/".concat(e))).data,bulkUploadEmployees:async e=>(await r.A.post("/employee/bulk-upload",e,{headers:{"Content-Type":"multipart/form-data"}})).data,updateEmployee:async(e,t)=>(await r.A.patch("/employee/update/".concat(e),t)).data,deleteEmployee:async e=>(await r.A.delete("/employee/delete/".concat(e))).data}},35196:(e,t,a)=>{a.d(t,{AuthProvider:()=>p,O:()=>h,A:()=>g});var r=a(95155),s=a(12115),o=a(35695),l=a(31530),i=a(64767);a(21934),a(94860),a(74228);var n=a(10351);let d=e=>{let{t,icon:a,title:s,message:o,borderColor:l}=e;return(0,r.jsx)("div",{className:"".concat(t.visible?"animate-enter":"animate-leave"," max-w-md w-full bg-white dark:bg-black dark:text-white text-black shadow-lg rounded-lg pointer-events-auto flex border-l-4 ").concat(l),children:(0,r.jsx)("div",{className:"flex-1 w-0 p-4",children:(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)("div",{className:"flex-shrink-0 pt-0.5",children:a}),(0,r.jsxs)("div",{className:"ml-3 flex-1",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:s}),(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-800 dark:text-gray-400",children:o})]})]})})})},c=["/","/login","/register","/forgot-password","/pages/services","/pages/auth","/pages/ramps","/pages/admin","/pages/p2p","/pages/about","/pages/streaming"],u=["/pages/payroll","/pages/p2p"],m=(0,s.createContext)(void 0),p=e=>{let{children:t}=e,[a,p]=(0,s.useState)(null),[g,h]=(0,s.useState)(!0),[x,y]=(0,s.useState)(null),[v,w]=(0,s.useState)(!1),f=(0,o.useRouter)(),b=(0,o.usePathname)(),j=e=>{try{let t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),a=decodeURIComponent(atob(t).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(a)}catch(e){return console.error("Error parsing token:",e),null}},A=e=>!e||Date.now()/1e3>e,N=()=>{localStorage.removeItem("authToken"),localStorage.removeItem("user"),p(null),y(null),f.replace("/")},k=async e=>{try{h(!0);let t=await i.Z.login(e);if(null==t?void 0:t.token){let a=j(t.token);if(a)y(a.exp),localStorage.setItem("authToken",t.token),e.authMode&&localStorage.setItem("authMode",e.authMode);else throw Error("Invalid token structure received")}else throw Error("No authentication token received");if(null==t?void 0:t.safeUser)return p(t.safeUser),localStorage.setItem("user",JSON.stringify(t.safeUser)),l.oR.custom(e=>(0,r.jsx)(d,{t:e,icon:(0,r.jsx)(n.A3x,{className:"h-6 w-6 text-green-500"}),title:"Login Successful",message:"Welcome back, ".concat(t.safeUser.email,"!"),borderColor:"border-green-500"})),"payroll"===e.authMode?f.push("/pages/payroll"):"p2p"===e.authMode?f.push("/pages/p2p"):t.safeUser.isAdmin?f.push("/pages/payroll"):f.push("/pages/employee"),{success:!0};throw Error("Invalid user data received")}catch(s){var t,a;console.error("Login error:",s);let e=(null==(a=s.response)||null==(t=a.data)?void 0:t.message)||"Failed to login. Please try again.";return l.oR.custom(t=>(0,r.jsx)(d,{t:t,icon:(0,r.jsx)(n.q_G,{className:"h-6 w-6 text-red-500"}),title:"Login Failed",message:e,borderColor:"border-red-500"})),{success:!1,error:e}}finally{h(!1)}},S=async e=>{try{return h(!0),await i.Z.register(e),l.oR.custom(e=>(0,r.jsx)(d,{t:e,icon:(0,r.jsx)(n.vq3,{className:"h-6 w-6 text-green-500"}),title:"Registration Successful",message:"Account created. Logging you in...",borderColor:"border-green-500"}),{duration:2e3}),await k({email:e.email,password:e.password,authMode:e.authMode})}catch(s){var t,a;console.error("Registration error:",s);let e=(null==(a=s.response)||null==(t=a.data)?void 0:t.message)||"Failed to register. Please try again.";return l.oR.custom(t=>(0,r.jsx)(d,{t:t,icon:(0,r.jsx)(n.q_G,{className:"h-6 w-6 text-red-500"}),title:"Registration Failed",message:e,borderColor:"border-red-500"})),{success:!1,error:e}}finally{h(!1)}};(0,s.useEffect)(()=>{if(!x)return;let e=x-Date.now()/1e3,t=null,s=null;return e>300?(t=setTimeout(()=>{l.oR.custom(e=>(0,r.jsx)(d,{t:e,icon:(0,r.jsx)(n.eHT,{className:"h-6 w-6 text-yellow-500"}),title:"Session Warning",message:"Your session will expire in 5 minutes.",borderColor:"border-yellow-500"}),{duration:1e4})},(e-300)*1e3),s=setTimeout(()=>{N(),l.oR.custom(e=>(0,r.jsx)(d,{t:e,icon:(0,r.jsx)(n.Ohp,{className:"h-6 w-6 text-red-500"}),title:"Session Expired",message:"Your session has ended. Please login again.",borderColor:"border-red-500"}))},1e3*e)):e>0?s=setTimeout(()=>{N(),l.oR.custom(e=>(0,r.jsx)(d,{t:e,icon:(0,r.jsx)(n.Ohp,{className:"h-6 w-6 text-red-500"}),title:"Session Expired",message:"Your session has ended. Please login again.",borderColor:"border-red-500"}))},1e3*e):a&&(N(),l.oR.custom(e=>(0,r.jsx)(d,{t:e,icon:(0,r.jsx)(n.Ohp,{className:"h-6 w-6 text-red-500"}),title:"Session Expired",message:"Your session has ended. Please login again.",borderColor:"border-red-500"}))),()=>{t&&clearTimeout(t),s&&clearTimeout(s)}},[x,a]);let E=async()=>{let e=localStorage.getItem("authToken"),t=localStorage.getItem("user");if(!e||!t)return p(null),c.includes(b||"")||"/"===b||f.replace("/"),h(!1),w(!0),!1;try{let a=j(e);if(!a||A(a.exp))throw Error("Token expired");y(a.exp);let s=JSON.parse(t);if(p(s),u.some(e=>null==b?void 0:b.startsWith(e))&&!s.isAdmin)return l.oR.custom(e=>(0,r.jsx)(d,{t:e,icon:(0,r.jsx)(n.del,{className:"h-6 w-6 text-red-500"}),title:"Access Denied",message:"You don't have permission to access this page.",borderColor:"border-red-500"})),f.replace("/"),h(!1),w(!0),!1;return h(!1),w(!0),!0}catch(e){return l.oR.custom(e=>(0,r.jsx)(d,{t:e,icon:(0,r.jsx)(n.Ohp,{className:"h-6 w-6 text-red-500"}),title:"Session Expired",message:"Your session is invalid or has ended. Please login again.",borderColor:"border-red-500"})),N(),h(!1),w(!0),!1}};return(0,s.useEffect)(()=>{E()},[]),(0,s.useEffect)(()=>{if(v){let e=localStorage.getItem("authToken"),t=localStorage.getItem("user");if(!e||!t){c.includes(b||"")||"/"===b||f.replace("/");return}a&&u.some(e=>null==b?void 0:b.startsWith(e))&&!a.isAdmin&&(l.oR.custom(e=>(0,r.jsx)(d,{t:e,icon:(0,r.jsx)(n.del,{className:"h-6 w-6 text-red-500"}),title:"Access Denied",message:"You don't have permission to access this page.",borderColor:"border-red-500"})),f.replace("/"))}},[b,v,a]),(0,s.useEffect)(()=>{let e=setInterval(async()=>{try{let e=await i.Z.ping();e?console.log("Ping successful:",e):console.log("Ping failed")}catch(e){console.log("Ping error:",e)}},45e3);return()=>clearInterval(e)},[]),(0,r.jsx)(m.Provider,{value:{user:a,isAuthenticated:!!a,isLoading:g,isAdmin:null==a?void 0:a.isAdmin,logout:N,login:k,register:S},children:t})},g=()=>{let e=(0,s.useContext)(m);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},h=e=>{let{route:t,children:a,requireAdmin:i=!1}=e,{user:c,isLoading:u,isAdmin:m}=g(),p=(0,o.useRouter)(),[h,x]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{if(!u){if(!c)return void p.replace("/pages/auth");if(i&&!c.isAdmin){l.oR.custom(e=>(0,r.jsx)(d,{t:e,icon:(0,r.jsx)(n.F5$,{className:"h-6 w-6 text-red-500"}),title:"Admin Required",message:"You need administrator privileges for this area.",borderColor:"border-red-500"})),p.replace("/");return}x(!0)}},[c,u,i,m,p,t]),u)?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen min-w-screen",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):h?(0,r.jsx)(r.Fragment,{children:a}):null}},46520:(e,t,a)=>{a.d(t,{p:()=>r});let r=a(49509).env.NEXT_PUBLIC_BACKEND_DOMAIN||"https://payzoll-server-pharos.onrender.com"},64767:(e,t,a)=>{a.d(t,{Z:()=>s});var r=a(74228);let s={login:async e=>{var t,a;let s=await r.A.post("/auth/login",e);return(null==(t=s.data)?void 0:t.token)&&localStorage.setItem("authToken",s.data.token),(null==(a=s.data)?void 0:a.safeUser)&&localStorage.setItem("user",JSON.stringify(s.data.safeUser)),console.log("Login response:",s.data),s.data},register:async e=>(await r.A.post("/auth/register",e)).data,forgotPassword:async e=>(await r.A.post("/auth/forgotPassword",{email:e})).data,ping:async()=>(await r.A.post("/auth/ping")).data}},74228:(e,t,a)=>{a.d(t,{A:()=>l});var r=a(23464);let s=a(46520).p,o=r.A.create({baseURL:s,headers:{"Content-Type":"application/json"}});o.interceptors.request.use(e=>{let t=localStorage.getItem("authToken");return t&&e.headers&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),o.interceptors.response.use(e=>e,e=>{let{response:t}=e;return(null==t?void 0:t.status)===401&&(localStorage.removeItem("authToken"),window.location.href="/"),Promise.reject({status:null==t?void 0:t.status,message:"object"==typeof(null==t?void 0:t.data)&&(null==t?void 0:t.data)&&"message"in t.data?t.data.message:"An unexpected error occurred",data:null==t?void 0:t.data,originalError:e})});let l=o},94860:(e,t,a)=>{a.d(t,{U:()=>s});var r=a(74228);let s={addPayroll:async e=>(await r.A.post("/payroll/add",e)).data,getPayrollHistory:async()=>(await r.A.get("/payroll/history")).data}}}]);